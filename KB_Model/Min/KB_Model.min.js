var CreateKB_Model=function(){function g(){function f(){for(var d=Object.keys(r),a=0,c={},b,e,a=0;a<d.length;a++)c=r[d[a]],b=t("local").getItem("KB_Model_"+d[a]),e=t("session").getItem("KB_Model_"+d[a]),b?c._getData=JSON.parse(b):e?c._getData=JSON.parse(e):(c._getData=f.deepCopy(c._tempData),c._save&&t(c._save).setItem("KB_Model_"+d[a],JSON.stringify(c._getData))),f.deepInject(c._getData,c._bindData,d[a]),c._model&&(g[d[a]]={},f.deepInject(c._getData,g[d[a]],"Model"))}var g={},r={},n={},l={},w=function(d){return Array.prototype.concat.apply([],
d.split(".").map(function(a,c){return a.split("[").map(function(a,c){return-1<a.indexOf("]")?"["+a:a})}))},x=function(d,a,c,b,f,l,n,r,y){this.stopPropagation=function(){this._stopPropogation=!0};this.preventDefault=function(){this._preventDefault=!0};this.viewModel=d;this.viewModelKey=a;this.scope=c;this.value=b;this.oldValue=f;this.scopeString=l;this.key=n;this.args=r;this.action=y},v=["local","session"],t=function(d){if(-1<v.indexOf(d))return"local"===d?localStorage:sessionStorage};f.Model=function(){return g};
f.ViewModel=function(d,a,c,b){if(void 0===a&&void 0===d)return r;if(void 0===a&&void 0!==d)return r[d]._bindData;r[d]={_tempData:a,_getData:{},_bindData:{},_save:void 0===c?!1:c,_model:!(void 0!==b&&!b)};return f};f.deepCopy=function(d,a){var c=Object.keys(d),b="",e=0;a=void 0===a?d.constructor.toString()===Object.toString()?{}:[]:a;for(e=0;e<c.length;e++)b=d[c[e]],b.constructor.toString()===Object.toString()?(a[c[e]]={},f.deepCopy(b,a[c[e]])):b.constructor.toString()===Array.toString()?(a[c[e]]=
[],f.deepCopy(b,a[c[e]])):a[c[e]]=b;return a};f.deepInject=function(d,a,c,b){b=void 0===b?"":b;c=void 0===c?"unknown":c;a=void 0===a?d.constructor.toString()===Object.toString()?{}:[]:a;var e=Object.keys(d),g,p;a=void 0===a?{}:a;var v=function(b,e,q){var g=e.constructor.toString()===Object.toString(),p=e.constructor.toString()===Array.toString();q=1>q.length&&e.constructor.toString()===Array.toString()?q+(b+"["):1>q.length?q+b:q.lastIndexOf("[")===q.length-1?q+(b+"]"+(e.constructor.toString()===Array.toString()?
"[":"")):e.constructor.toString()===Array.toString()?q+("."+b+"["):q+("."+b);g||p?(Object.defineProperty(a,b,{value:g?{}:[],writable:!1,enumerable:!0,configurable:!0}),f.deepInject(d[b],a[b],c,q)):Object.defineProperty(a,b,{get:function(){return d[b]},set:function(f){var e=d[b],h;h=q;var m=new x(r[c],c,a,f,e,h,b),k=0,g=0,p=w(h),u="";if(void 0!==n[b])b:for(k=0;k<n[b].length;k++)if(n[b][k].call({},m),m._stopPropogation)break b;if(!m._stopPropogation)b:for(g=0;g<p.length;g++)if(u=p.slice(0,g+1).join(".").replace(/(\.\[)/g,
"["),void 0!==n[u]&&!m._stopPropogation)for(k=0;k<n[u].length;k++)if(n[u][k].call({},m),m._stopPropogation)break b;if(void 0!==n[h]&&!m._stopPropogation)b:for(k=0;k<n[h].length;k++)if(n[h][k].call({},m),m._stopPropogation)break b;h=m._preventDefault?!1:!0;h&&(d[b]=f);h=c;m=q;f=new x(r[h],h,a,f,e,m,b,void 0,void 0);k=e=0;g=w(m);p="";if(void 0!==l[b])b:for(e=0;e<l[b].length;e++)if(l[b][e].call({},f),f._stopPropogation)break b;if(!f._stopPropogation)b:for(k=0;k<g.length;k++)if(p=g.slice(0,k+1).join(".").replace(/(\.\[)/g,
"["),void 0!==l[p]&&!f._stopPropogation)for(e=0;e<l[p].length;e++)if(l[p][e].call({},f),f._stopPropogation)break b;if(void 0!==l[m]&&!f._stopPropogation)b:for(e=0;e<l[m].length;e++)if(l[m][e].call({},f),f._stopPropogation)break b;f=t("local").getItem("KB_Model_"+h);e=t("session").getItem("KB_Model_"+h);f?t("local").setItem("KB_Model_"+h,JSON.stringify(r[h]._getData)):e&&t("session").setItem("KB_Model_"+h,JSON.stringify(r[h]._getData))},enumerable:!0,configurable:!0})};for(p=0;p<e.length;p++)g=d[e[p]],
v(e[p],g,b);return a};f.addDataListener=function(d,a){void 0===n[d]&&(n[d]=[]);n[d].push(a);return f};f.removeDataListener=function(d,a){var c=0,b=dataListeners[d];if(void 0!==b)a:for(c=0;c<b.length;c++)if(b[c].toString()===a.toString()){b.splice(c,1);break a}return f};f.getDataListeners=function(){return n};f.addDataUpdateListener=function(d,a){void 0===l[d]&&(l[d]=[]);l[d].push(a);return f};f.removeDataUpdateListener=function(d,a){var c=0,b=l[d];if(void 0!==b)a:for(c=0;c<b.length;c++)if(b[c].toString()===
a.toString()){b.splice(c,1);break a}return f};f.getDataUpdateListeners=function(){return l};return f}"function"===typeof define&&define.amd?(define("KB_Model",g),define([],g)):"object"===typeof module&&module.exports&&(module.exports=g);return g}();
