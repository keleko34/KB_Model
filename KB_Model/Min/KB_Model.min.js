var CreateKB_Model=function(){function g(){function e(){for(var d=Object.keys(r),b=0,c={},a,f,b=0;b<d.length;b++)c=r[d[b]],a=t("local").getItem("KB_Model_"+d[b]),f=t("session").getItem("KB_Model_"+d[b]),a?c._getData=JSON.parse(a):f?c._getData=JSON.parse(f):(c._getData=e.deepCopy(c._tempData),c._save&&t(c._save).setItem("KB_Model_"+d[b],JSON.stringify(c._getData))),e.deepInject(c._getData,c._bindData,d[b]),c._model&&(g[d[b]]={},e.deepInject(c._getData,g[d[b]],"Model"))}var g={},r={},p={},n={},v=function(d){return Array.prototype.concat.apply([],
d.split(".").map(function(b,c){return b.split("[").map(function(b,c){return-1<b.indexOf("]")?"["+b:b})}))},w=function(d,b,c,a,e,n,p,g){this.stopPropagation=function(){this._stopPropogation=!0};this.preventDefault=function(){this._preventDefault=!0};this.viewModel=d;this.scope=b;this.value=c;this.oldValue=a;this.scopeString=e;this.key=n;this.args=p;this.action=g},q=["local","session"],t=function(d){if(-1<q.indexOf(d))return"local"===d?localStorage:sessionStorage};e.Model=function(){return g};e.ViewModel=
function(d,b,c,a){if(void 0===b&&void 0===d)return r;if(void 0===b&&void 0!==d)return r[d]._bindData;r[d]={_tempData:b,_getData:{},_bindData:{},_save:void 0===c?!1:c,_model:!(void 0!==a&&!a)};return e};e.deepCopy=function(d,b){var c=Object.keys(d),a="",f=0;b=void 0===b?{}:b;for(f=0;f<c.length;f++)a=d[c[f]],a.constructor.toString()===Object.toString()?(b[c[f]]={},e.deepCopy(a,b[c[f]])):a.constructor.toString()===Array.toString()?(b[c[f]]=[],e.deepCopy(a,b[c[f]])):b[c[f]]=a;return b};e.deepInject=function(d,
b,c,a){a=void 0===a?"":a;c=void 0===c?"unknown":c;var f=Object.keys(d),g,k;b=void 0===b?{}:b;var q=function(a,f,g){var k=f.constructor.toString()===Object.toString(),q=f.constructor.toString()===Array.toString();g=1>g.length&&f.constructor.toString()===Array.toString()?g+(a+"["):1>g.length?g+a:g.lastIndexOf("[")===g.length-1?g+(a+"]"+(f.constructor.toString()===Array.toString()?"[":"")):f.constructor.toString()===Array.toString()?g+("."+a+"["):g+("."+a);k||q?(Object.defineProperty(b,a,{value:k?{}:
[],writable:!1,enumerable:!0,configurable:!0}),e.deepInject(d[a],b[a],c,g)):Object.defineProperty(b,a,{get:function(){return d[a]},set:function(f){var e=d[a],l;l=g;var m=new w(c,b,f,e,l,a),h=0,k=0,u=v(l),q="";if(void 0!==p[a])b:for(h=0;h<p[a].length;h++)if(p[a][h].call({},m),m._stopPropogation)break b;if(!m._stopPropogation)b:for(k=0;k<u.length;k++)if(q=u.slice(0,k+1).join(".").replace(/(\.\[)/g,"["),void 0!==p[q]&&!m._stopPropogation)for(h=0;h<p[q].length;h++)if(p[q][h].call({},m),m._stopPropogation)break b;
if(void 0!==p[l]&&!m._stopPropogation)b:for(h=0;h<p[l].length;h++)if(p[l][h].call({},m),m._stopPropogation)break b;l=m._preventDefault?!1:!0;l&&(d[a]=f);l=c;m=g;f=new w(l,b,f,e,m,a,void 0,void 0);h=e=0;k=v(m);u="";if(void 0!==n[a])b:for(e=0;e<n[a].length;e++)if(n[a][e].call({},f),f._stopPropogation)break b;if(!f._stopPropogation)b:for(h=0;h<k.length;h++)if(u=k.slice(0,h+1).join(".").replace(/(\.\[)/g,"["),void 0!==n[u]&&!f._stopPropogation)for(e=0;e<n[u].length;e++)if(n[u][e].call({},f),f._stopPropogation)break b;
if(void 0!==n[m]&&!f._stopPropogation)b:for(e=0;e<n[m].length;e++)if(n[m][e].call({},f),f._stopPropogation)break b;f=t("local").getItem("KB_Model_"+l);e=t("session").getItem("KB_Model_"+l);f?t("local").setItem("KB_Model_"+l,JSON.stringify(r[l]._getData)):e&&t("session").setItem("KB_Model_"+l,JSON.stringify(r[l]._getData))},enumerable:!0,configurable:!0})};for(k=0;k<f.length;k++)g=d[f[k]],q(f[k],g,a);return b};e.addDataListener=function(d,b){void 0===p[d]&&(p[d]=[]);p[d].push(b);return e};e.removeDataListener=
function(d,b){var c=0,a=dataListeners[d];if(void 0!==a)a:for(c=0;c<a.length;c++)if(a[c].toString()===b.toString()){a.splice(c,1);break a}return e};e.addDataUpdateListener=function(d,b){void 0===n[d]&&(n[d]=[]);n[d].push(b);return e};e.removeDataUpdateListener=function(d,b){var c=0,a=n[d];if(void 0!==a)a:for(c=0;c<a.length;c++)if(a[c].toString()===b.toString()){a.splice(c,1);break a}return e};return e}"function"===typeof define&&define.amd?(define("KB_Model",g),define([],g)):"object"===typeof module&&
module.exports&&(module.exports=g);return g}();
